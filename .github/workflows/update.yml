name: è‡ªåŠ¨åˆå¹¶å¹¶æ›´æ–° List æ–‡ä»¶

on:
  # æ¯å¤©è¿è¡Œä¸€æ¬¡çš„å®šæ—¶ä»»åŠ¡ï¼Œè®¾ç½®ä¸º UTC æ—¶é—´ 08:00ï¼ˆå¤§çº¦åŒ—äº¬æ—¶é—´ä¸‹åˆ 4 ç‚¹ï¼‰
  schedule:
    - cron: '0 8 * * *'
  # ä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  update-list:
    runs-on: ubuntu-latest
    permissions:
      contents: write # æˆäºˆå†™å…¥æƒé™
    steps:
      - name: â¬‡ï¸ æ£€å‡ºä½ çš„é¡¹ç›®ä»£ç 
        # ä½¿ç”¨ actions/checkout@v4 æ¥è·å–ä½ çš„é¡¹ç›®ä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ“¥ ä¸‹è½½ Alist å’Œ Blist æ–‡ä»¶
        run: |
          echo "ä¸‹è½½ Gemini æ–‡ä»¶..."
          curl -sS https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Gemini/Gemini.list -o Gemini.list
          curl -sS https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/QuantumultX/Gemini/Gemini.list -o Gemini_qx.list

          echo "ä¸‹è½½ OpenAI æ–‡ä»¶..."
          curl -sS https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/OpenAI/OpenAI.list -o OpenAI.list
          curl -sS https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/QuantumultX/OpenAI/OpenAI.list -o OpenAI_qx.list

          echo "ä¸‹è½½ Claude æ–‡ä»¶..."
          curl -sS https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Claude/Claude.list -o Claude.list
          curl -sS https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/QuantumultX/Claude/Claude.list -o Claude_qx.list


      - name: ğŸ“ åˆå¹¶æ–‡ä»¶
        run: |
          echo "æ­£åœ¨åˆå¹¶æ–‡ä»¶..."
          cat Gemini.list > clash/ai.list
          cat OpenAI.list >> clash/ai.list
          cat Claude.list >> clash/ai.list

          cat Gemini_qx.list > quantumultx/ai.list
          cat OpenAI_qx.list >> quantumultx/ai.list
          cat Claude_qx.list >> quantumultx/ai.list
          

      - name: ğŸ“¦ é…ç½® Git ç”¨æˆ·ä¿¡æ¯
        # è¿™ä¸€æ­¥æ˜¯è®© Action èƒ½å¤Ÿä»¥æ­£ç¡®çš„èº«ä»½æäº¤ä»£ç 
        run: |
          git config user.name github-actions[bot]
          git config user.email 41898282+github-actions[bot]@users.noreply.github.com

      - name: ğŸ“¤ æ£€æŸ¥å¹¶æäº¤æ›´æ–°
        # æ£€æŸ¥ list æ–‡ä»¶æ˜¯å¦æœ‰å˜åŒ–ï¼Œå¦‚æœæœ‰å˜åŒ–åˆ™æäº¤å¹¶æ¨é€
        # --allow-empty é¿å…æ²¡æœ‰ä¿®æ”¹æ—¶å¯¼è‡´è„šæœ¬æŠ¥é”™
        run: |
          FILE_PATH_1="clash/ai.list"
          FILE_PATH_2="quantumultx/ai.list"
          DIFF_1=$(git diff --exit-code -- $FILE_PATH_1 || echo 1)
          # æ£€æŸ¥ç¬¬äºŒä¸ªæ–‡ä»¶æ˜¯å¦æœ‰å·®å¼‚ (è¿”å›ç  1 è¡¨ç¤ºæœ‰å·®å¼‚)
          DIFF_2=$(git diff --exit-code -- $FILE_PATH_2 || echo 1)
          if [ "$DIFF_1" = "1" ] || [ "$DIFF_2" = "1" ]; then
            echo "æ–‡ä»¶æ²¡æœ‰å˜åŠ¨ï¼Œè·³è¿‡æäº¤"
          else
            echo "æ–‡ä»¶å·²æ›´æ–°ï¼Œæ­£åœ¨æäº¤..."
            git add $FILE_PATH_1 $FILE_PATH_2
            git commit -m " chore(list): Auto update AI list [skip ci] "
            git push
            echo "æ–‡ä»¶æ›´æ–°å¹¶æ¨é€å®Œæˆã€‚"
          fi